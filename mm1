-- Config
_G.KeepAmount = {
    -- Event Beanstalk (~120)
    ["Beanstalk"] = 20,
    ["Burning Bud"] = 20,
    ["Ember Lily"] = 20,
    ["Flare Daisy"] = 20,
    ["Duskpuff"] = 15,
    ["Pepper"] = 15,
    ["Jalapeno"] = 10,
    ["Badlands Pepper"] = 5,
    ["Sugarglaze"] = 10,

    -- Farm tiền (~100)
    ["Sugar Apple"] = 30,
    ["Apple"] = 10,
    ["Mango"] = 10,
    ["Grape"] = 10,
    ["Blueberry"] = 10,
    ["Coconut"] = 10,
    ["Corn"] = 10,
    ["Onion"] = 10,
    ["Strawberry"] = 10,
    ["Tomato"] = 10,
    ["Pumpkin"] = 5,
    ["Watermelon"] = 5,
    ["Dragon Fruit"] = 10
}

_G.Treelist = {

}
_G.Remove = true

-- Không cần chỉnh đoạn dưới nếu bạn không biết rõ

local player = game.Players.LocalPlayer

local function getOwnedPlot()
    for _, plot in pairs(workspace.Farm:GetChildren()) do
        local important = plot:FindFirstChild("Important") or plot:FindFirstChild("Importanert")
        if important then
            local data = important:FindFirstChild("Data")
            if data and data:FindFirstChild("Owner") and data.Owner.Value == player.Name then
                return plot
            end
        end
    end
    return nil
end

local function EquipShovel()
    local shovel = player.Backpack:FindFirstChild("Shovel [Destroy Plants]")
    if shovel then
        shovel.Parent = player.Character
    end
end

-- Đếm số lượng cây hiện có theo tên
local function countPlant(plot, plantName)
    local count = 0
    for _, plant in pairs(plot.Important.Plants_Physical:GetChildren()) do
        if string.match(plant.Name, plantName) then
            count += 1
        end
    end
    return count
end

-- Kiểm tra tên cây có trong danh sách không
local function isInTreelist(treeName)
    for _, name in pairs(_G.Treelist) do
        if string.match(treeName, name) then
            return true
        end
    end
    return false
end

local function DestroyTree()
    local success, err = pcall(function()
        if not _G.Remove then return end
        local plot = getOwnedPlot()
        if not plot then return end
        EquipShovel()

        for _, plant in pairs(plot.Important.Plants_Physical:GetChildren()) do
            if plant:IsA("Model") and not isInTreelist(plant.Name) then
                local keepLimit = _G.KeepAmount[plant.Name]
                if keepLimit then
                    local currentCount = countPlant(plot, plant.Name)
                    if currentCount > keepLimit then
                        -- chỉ xóa nếu vượt quá số lượng cần giữ
                        local part = plant.PrimaryPart or plant:FindFirstChildWhichIsA("BasePart")
                        if part then
                            game.ReplicatedStorage.GameEvents.Remove_Item:FireServer(part)
                            task.wait(0.05)
                        end
                    end
                else
                    -- nếu không có config giữ lại thì xóa hết
                    local part = plant.PrimaryPart or plant:FindFirstChildWhichIsA("BasePart")
                    if part then
                        game.ReplicatedStorage.GameEvents.Remove_Item:FireServer(part)
                        task.wait(0.05)
                    end
                end
            end
        end
    end)
    if not success then
        warn("Lỗi khi xóa cây: " .. err)
    end
end

while task.wait(3) do
    DestroyTree()
end
